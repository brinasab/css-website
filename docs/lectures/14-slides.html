<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="Sabrina Nardin, Fall 2025">
  <title>css-website ‚Äì Computing for the Social Sciences: Lecture 14</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-864c5404f4710dceefb0a9fe440f50a1.css">
  <link rel="stylesheet" href="../style/styles.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Computing for the Social Sciences: Lecture 14</h1>
  <p class="subtitle">Topics: Functions 2, Debugging</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Sabrina Nardin, Fall 2025 
</div>
</div>
</div>

</section>
<section id="agenda" class="title-slide slide level1 center">
<h1>Agenda</h1>
<div class="agenda-list">
<ol type="1">
<li>Functions</li>
<li>Debugging</li>
</ol>
</div>
<p><span style="font-size: 0.8em; color: #666;"> <em>Slides last updated on <strong>November 12, 2025</strong>. Slides authored by Sabrina Nardin. AI used to polish slides style and fix typos.</em> </span></p>
</section>

<section>
<section id="functions" class="title-slide slide level1 center middle">
<h1>1. Functions</h1>

</section>
<section id="from-using-to-writing-functions" class="slide level2 center">
<h2>From using to writing functions</h2>
<p>Last lecture we learned the following concepts:</p>
<ul>
<li>Using existing functions</li>
<li>Writing your own function</li>
<li>The return statement</li>
<li>stop()</li>
</ul>
<p>Today we add:</p>
<ul>
<li>Anonymous functions</li>
<li>Documenting your function</li>
<li>Writing functions with dplyr and ggplot</li>
</ul>
</section>
<section id="anonymous-functions" class="slide level2 center">
<h2>Anonymous Functions</h2>
<p>Anonymous functions are <strong>functions without a name</strong></p>
<p><strong>When to use them:</strong></p>
<ul>
<li><p>When the function is very short and you need it only once</p></li>
<li><p>When another function (like those in the <code>apply()</code> family) expects another function as input</p></li>
</ul>
<p>Whenever you can: write the function explicitly instead!</p>
</section>
<section id="anonymous-functions-with-a-number-as-input" class="slide level2 center">
<h2>Anonymous Functions with a number as input</h2>
<p>Imagine we have the following function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-2"><a></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">3</span>) }</span>
<span id="cb1-3"><a></a><span class="fu">add</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Re-write it as an anonymous function. Note: one line, no name, and call it with <code>()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>(<span class="cf">function</span>(x) {x <span class="sc">+</span> <span class="dv">3</span>}) (<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Often anonymous functions are written without the <code>{}</code>, like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">3</span>) (<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
Here's an anonymous function for calculating the mean of a vector `x`. In the following example, the input `x` to the function is each element of the list `l`.

::: {.cell}
::: {.cell-output .cell-output-stdout}

```
[[1]]
[1] 3

[[2]]
[1] 6
```


:::
:::


see http://adv-r.had.co.nz/Functional-programming.html#anonymous-functions
-->
</section>
<section id="anonymous-functions-with-a-vector-as-input" class="slide level2 center">
<h2>Anonymous Functions with a vector as input</h2>
<p>Same function as before but here we pass a vector as input rather than a single number:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-2"><a></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">3</span>) }</span>
<span id="cb4-3"><a></a><span class="fu">add</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To rewrite it as anonymous function, the following two codes <strong>won‚Äôt work</strong> because the vector isn‚Äôt passed correctly:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">3</span>) (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb5-2"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">3</span>) <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Instead, <strong>either of these works correctly</strong>, since the entire vector is passed as a single argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">3</span>) (<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb6-2"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">3</span>) (<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
So the problem isn‚Äôt that anonymous functions can‚Äôt handle multiple values ‚Äî they can!
The issue is the comma-separated syntax, which in R means multiple arguments, not a vector of values.
-->
</section>
<section id="anonymous-functions-with-sapply-and-lapply" class="slide level2 center">
<h2>Anonymous Functions with sapply() and lapply()</h2>
<p>You can also rewrite the previous code using <code>sapply()</code> or <code>lapply()</code>. Remember them from last time? They can be used to avoid writing for loops in R.</p>
<p>Both belong to the <code>apply()</code> family and have the same basic structure:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">lapply</span>(X, FUN)</span>
<span id="cb7-2"><a></a><span class="fu">sapply</span>(X, FUN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>X</code> is a vector or list (the input)</li>
<li><code>FUN</code> is a function to apply to each element of X</li>
</ul>
<p>They both loop through the elements of <code>X</code>, apply <code>FUN</code> to each element‚Ä¶</p>
</section>
<section id="anonymous-functions-with-sapply-and-lapply-1" class="slide level2 center">
<h2>Anonymous Functions with sapply() and lapply()</h2>
<p>‚Ä¶But then differ in how they return the result:</p>
<ul>
<li><code>lapply</code> means ‚Äúlist apply‚Äù, always returns the output as a list</li>
<li><code>sapply()</code> means ‚Äúsimplify apply‚Äù, returns a simplified version of the list (usually a vector, sometimes a matrix)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co"># previous anonymous function</span></span>
<span id="cb8-2"><a></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>) (<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb8-3"><a></a></span>
<span id="cb8-4"><a></a><span class="co"># re-written with sapply</span></span>
<span id="cb8-5"><a></a><span class="fu">sapply</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb8-6"><a></a></span>
<span id="cb8-7"><a></a><span class="co"># re-written with lapply</span></span>
<span id="cb8-8"><a></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Tip:</strong> Using <code>sapply()</code> is more common because it returns a vector, which is easier to work with that a list!</p>
</section>
<section id="anonymous-functions-the-purrr-way" class="slide level2 center">
<h2>Anonymous Functions the purrr way</h2>
<p>The <code>purrr</code> package (remember the <code>map()</code>, <code>map_dbl()</code>, etc. functions from last lecture? they come from this same package!) provides another way to write anonymous functions.</p>
<p>Same function as before that adds 1 to each element of thhe input:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-2"><a></a>  x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-3"><a></a>}</span>
<span id="cb9-4"><a></a><span class="fu">add</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rewrite it as anonymous function in <a href="https://purrr.tidyverse.org/reference/map.html"><code>purrr</code></a> in two ways:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb10-2"><a></a><span class="fu">map_dbl</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb10-3"><a></a><span class="fu">map_dbl</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="sc">~</span>.x <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Tip:</strong> <code>map()</code> has several versions like <code>map_dbl()</code>, <code>map_chr()</code>, and <code>map_df()</code> which let you control the output type directly, no guessing like with <code>sapply()</code>.</p>
</section>
<section id="practice-writing-functions" class="slide level2 center">
<h2>üíª Practice writing functions</h2>
<h3 id="download-last-class-materials-from-the-website.-complete-question-3">Download last class materials from the website. Complete question 3</h3>
<p>Last class we did question 1, 2, and 4. <strong>Now: question 3 on anonymous functions!</strong></p>
</section>
<section id="functions-should-be-well-documented-how" class="slide level2 center">
<h2>Functions should be well-documented! How?</h2>
<p>Each function should include the following:</p>
<ul>
<li>a one-sentence description of the function summarizing what it does</li>
<li>all function‚Äôs arguments, denoted as <code>Args:</code>, with their data types</li>
<li>a description of the return value, denoted by <code>Returns:</code></li>
</ul>
<p><strong>Do not use AI do generate your documentation: it tends to overly complicate things, and is not good</strong></p>
</section>
<section id="codying-style-document-your-function" class="slide level2 center">
<h2>Codying style: document your function</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(vector) {</span>
<span id="cb11-2"><a></a>  </span>
<span id="cb11-3"><a></a>  <span class="co"># Calculates the sum of all numbers in a numeric vector using a `for` loop.</span></span>
<span id="cb11-4"><a></a>  <span class="co"># Args:</span></span>
<span id="cb11-5"><a></a>  <span class="co">#   vector (num): a numeric vector whose elements will be summed</span></span>
<span id="cb11-6"><a></a>  <span class="co"># Returns:</span></span>
<span id="cb11-7"><a></a>  <span class="co">#  value (num): single numeric value.</span></span>
<span id="cb11-8"><a></a>  <span class="co"># Example use:</span></span>
<span id="cb11-9"><a></a>  <span class="co">#   x &lt;- c(3, 1, 4)</span></span>
<span id="cb11-10"><a></a>  <span class="co">#   my_sum(x)</span></span>
<span id="cb11-11"><a></a>    </span>
<span id="cb11-12"><a></a>  total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-13"><a></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(vector)) {</span>
<span id="cb11-14"><a></a>    total <span class="ot">&lt;-</span> total <span class="sc">+</span> vector[i]</span>
<span id="cb11-15"><a></a>  }</span>
<span id="cb11-16"><a></a>  total</span>
<span id="cb11-17"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-from-googles-r-style-guide-here" class="slide level2 center">
<h2>Example from Google‚Äôs R Style Guide <a href="https://web.stanford.edu/class/cs109l/unrestricted/resources/google-style.html#:~:text=Function%20Documentation,-Functions%20should%20contain&amp;text=These%20comments%20should%20consist%20of,value%2C%20denoted%20by%20Returns%3A%20.">here</a></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>CalculateSampleCovariance <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">verbose =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb12-2"><a></a></span>
<span id="cb12-3"><a></a>  <span class="co"># Computes the sample covariance between two vectors.</span></span>
<span id="cb12-4"><a></a>  <span class="co"># Args:</span></span>
<span id="cb12-5"><a></a>  <span class="co">#   x: One of two vectors whose sample covariance is to be calculated.</span></span>
<span id="cb12-6"><a></a>  <span class="co">#   y: The other vector. x and y must have the same length, greater than one,</span></span>
<span id="cb12-7"><a></a>  <span class="co">#      with no missing values.</span></span>
<span id="cb12-8"><a></a>  <span class="co">#   verbose: If TRUE, prints sample covariance; if not, not. Default is TRUE.</span></span>
<span id="cb12-9"><a></a>  <span class="co"># Returns:</span></span>
<span id="cb12-10"><a></a>  <span class="co">#   The sample covariance between x and y.</span></span>
<span id="cb12-11"><a></a>  </span>
<span id="cb12-12"><a></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb12-13"><a></a>  <span class="cf">if</span> (n <span class="sc">&lt;=</span> <span class="dv">1</span> <span class="sc">||</span> n <span class="sc">!=</span> <span class="fu">length</span>(y)) {</span>
<span id="cb12-14"><a></a>    <span class="fu">stop</span>(<span class="st">"Arguments x and y have invalid lengths: "</span>,</span>
<span id="cb12-15"><a></a>         <span class="fu">length</span>(x), <span class="st">" and "</span>, <span class="fu">length</span>(y), <span class="st">"."</span>) }</span>
<span id="cb12-16"><a></a>  <span class="cf">if</span> (<span class="cn">TRUE</span> <span class="sc">%in%</span> <span class="fu">is.na</span>(x) <span class="sc">||</span> <span class="cn">TRUE</span> <span class="sc">%in%</span> <span class="fu">is.na</span>(y)) {</span>
<span id="cb12-17"><a></a>    <span class="fu">stop</span>(<span class="st">" Arguments x and y must not have missing values."</span>) }</span>
<span id="cb12-18"><a></a>  covariance <span class="ot">&lt;-</span> <span class="fu">var</span>(x, y)</span>
<span id="cb12-19"><a></a>  <span class="cf">if</span> (verbose)</span>
<span id="cb12-20"><a></a>    <span class="fu">cat</span>(<span class="st">"Covariance = "</span>, <span class="fu">round</span>(covariance, <span class="dv">4</span>), <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb12-21"><a></a>  <span class="fu">return</span>(covariance)</span>
<span id="cb12-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functions-and" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p>You can write custom functions and use them together with <code>dplyr</code> or <code>ggplot</code> functions!</p>
<p>You need the following:</p>
<ul>
<li>syntax to write a custom function</li>
<li>special operators that allows R to evaluate your custom functions correctly:
<ul>
<li>bang-bang <code>!!</code> with <code>enquo()</code> (this is the old method)</li>
<li>curly-curly or embracing <code>{ }</code> (this replaced the former method!)</li>
</ul></li>
</ul>
<p>Check out Chapter 25 of our book for details <a href="https://r4ds.hadley.nz/functions.html" class="uri">https://r4ds.hadley.nz/functions.html</a></p>
</section>
<section id="functions-and-1" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p>Example: create a data frame of age and height of 5 individuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-2"><a></a></span>
<span id="cb13-3"><a></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">10</span>), </span>
<span id="cb13-4"><a></a>             <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">110</span>, <span class="dv">140</span>, <span class="dv">155</span>, <span class="dv">170</span>, <span class="dv">130</span>))</span>
<span id="cb13-5"><a></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
    age height
  &lt;dbl&gt;  &lt;dbl&gt;
1    10    110
2    12    140
3    13    155
4    14    170
5    10    130</code></pre>
</div>
</div>
</section>
<section id="functions-and-2" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p>Use <code>summarize()</code> from <code>dplyr</code> to compute the mean and standard deviation on the column <code>age</code> of this data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>df <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a></a>  <span class="fu">summarize</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb15-3"><a></a>            <span class="at">sd_age =</span> <span class="fu">sd</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  mean_age sd_age
     &lt;dbl&gt;  &lt;dbl&gt;
1     11.8   1.79</code></pre>
</div>
</div>
</section>
<section id="functions-and-3" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p>Rewrite the previous code using a function and the curly-curly operator (embracing):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>custom_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, col) {</span>
<span id="cb17-2"><a></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a></a>    <span class="fu">summarize</span>(<span class="at">mean_value =</span> <span class="fu">mean</span>({{ col }}),</span>
<span id="cb17-4"><a></a>              <span class="at">sd_value =</span> <span class="fu">sd</span>({{ col }}))</span>
<span id="cb17-5"><a></a>}</span>
<span id="cb17-6"><a></a></span>
<span id="cb17-7"><a></a><span class="fu">custom_summary</span>(df, age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  mean_value sd_value
       &lt;dbl&gt;    &lt;dbl&gt;
1       11.8     1.79</code></pre>
</div>
</div>
<p>The <code>{ }</code> operator tells <code>dplyr</code> not to treat ‚Äúcol‚Äù as the literal variable name, but instead to look inside it for the variable we actually need (here ‚Äúage‚Äù)</p>
</section>
<section id="functions-and-4" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p><strong>Embracing a variable means to wrap it in braces so <code>var</code> becomes <code>{ var }</code> when using functions <code>dplyr</code> or <code>ggplot</code> code.</strong></p>
<p>It tells <code>dplyr</code> to use the value stored inside the argument, not the argument as the literal variable name</p>
<p>From the book: ‚Äúone way to remember what‚Äôs happening is to think of <code>{ }</code> as looking down a tunnel ‚Äî <code>{ var }</code> will make a <code>dplyr</code> function look inside of var rather than looking for a variable called var‚Äù</p>
</section>
<section id="functions-and-5" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p>Rewrite it with multiple columns as arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>custom_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, col1, col2) {</span>
<span id="cb19-2"><a></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-3"><a></a>    <span class="fu">summarise</span>(data, </span>
<span id="cb19-4"><a></a>              <span class="at">mean_value =</span> <span class="fu">mean</span>({{ col1 }}),</span>
<span id="cb19-5"><a></a>              <span class="at">sd_value =</span> <span class="fu">sd</span>({{ col1 }})),</span>
<span id="cb19-6"><a></a>    <span class="fu">summarise</span>(data, </span>
<span id="cb19-7"><a></a>              <span class="at">mean_value =</span> <span class="fu">mean</span>({{ col2 }}),</span>
<span id="cb19-8"><a></a>              <span class="at">sd_value =</span> <span class="fu">sd</span>({{ col2 }}))</span>
<span id="cb19-9"><a></a>  )</span>
<span id="cb19-10"><a></a>  <span class="co"># Combine output into a single data frame</span></span>
<span id="cb19-11"><a></a>  <span class="fu">bind_rows</span>(results)</span>
<span id="cb19-12"><a></a>}</span>
<span id="cb19-13"><a></a><span class="fu">custom_summary</span>(df, age, height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 2
  mean_value sd_value
       &lt;dbl&gt;    &lt;dbl&gt;
1       11.8     1.79
2      141      23.0 </code></pre>
</div>
</div>
</section>
<section id="functions-and-6" class="slide level2 center">
<h2>Functions and {{ }}</h2>
<p><strong>When do you need to embrace when writing a function?</strong></p>
<p>In all cases of tidy evaluation. Two main subtypes (see Chapter 25 for details):</p>
<ul>
<li><p>Data Masking: in functions such as <code>arrange()</code>, <code>filter()</code>, <code>summarize()</code> often when you need to pass a variable name; includes also <code>aes()</code> from <code>gglot2</code></p></li>
<li><p>Tidy Selection: in functions such as <code>select()</code>, <code>relocate()</code>, <code>rename()</code> that select variables</p></li>
</ul>
<!--
### Functions and `{{ }}`: additional resources

**Using bang-bang `!!`**

* Chapter ["7 Tidy evaluation"](https://krlmlr.github.io/tidyprog/tidy-evaluation.html): explanation with examples on how and why to use `!!` with `enquo`

* Blog post ["Writing Custom Tidyverse Functions"](https://jonthegeek.com/2018/06/04/writing-custom-tidyverse-functions/): explanation with step-by-step example on how and when to use `!!` with `ensym` and with `enquo`

* Another example [here](http://zevross.com/blog/2018/09/11/writing-efficient-and-streamlined-r-code-with-help-from-the-new-rlang-package/) 

**Using curly-curly `{{ }}`**

* Blog post ["Curly-Curly, the successor of Bang-Bang"](https://www.r-bloggers.com/2019/06/curly-curly-the-successor-of-bang-bang/)

* Another example [here](https://agstats.io/post/writing-r-functions/) (under "Functions and Tidy Evaluation")
-->
</section>
<section id="practice-writing-functions-1" class="slide level2 center">
<h2>üíª Practice writing functions</h2>
<h3 id="download-last-class-materials-from-the-website.-complete-question-7">Download last class materials from the website. Complete question 7</h3>
</section></section>
<section>
<section id="debugging" class="title-slide slide level1 center middle">
<h1>2. Debugging</h1>

</section>
<section id="bugs" class="slide level2 center">
<h2>Bugs</h2>
<p>A <strong>bug</strong> is an error or flaw in a computer program that causes it to stop or to behave in unintended ways (e.g., produce an incorrect result).</p>
<p>When we talk about bugs, we refer to <strong>two main types:</strong></p>
<ul>
<li>syntactic bugs (such as typos)</li>
<li>bugs resulting from a misunderstanding of R‚Äôs rules</li>
</ul>
<p>We all encounter both types of bugs. Fixing the latter requires time and experience, but we can address syntactic bugs faster by improving our coding style!</p>
<!--
## Debugging

  * Define a computer bug
  * Practice finding bugs in code
  * Debugging 
  * Defensive programming (preventing bugs)

## üíª Practice finding bugs in code

### Download today's class materials from the website.
-->
</section>
<section class="slide level2 center">

<h3 id="basic-debugging-techniques">Basic debugging techniques</h3>
<p>What debugging tips did you learn from working with R so far?</p>
<ol type="1">
<li><p>Realize that you have a bug</p></li>
<li><p>Figure out where it is</p>
<ul>
<li>read your code out loud</li>
<li>use <code>print()</code> statements to check each line</li>
<li>run a piece of code at a time</li>
<li>take a break!</li>
</ul></li>
<li><p>Fix it</p></li>
</ol>
<p>Review ‚ÄúDebugging R code‚Äù in <a href="https://rstats.wtf/debugging-r">What They Forgot to Teach You About R</a>, for more!</p>
<!--

## The call stack

**Often, the actual cause of a problem is not in the line of code we run.**

For example, consider these two functions: `f` which processes an input `x`, and `g`, which calls function `f`. In our code, we call function `g` and we get an error, but the problem is actually in function `f`:


::: {.cell}
::: {.cell-output .cell-output-error}

```
Error in x + 1: non-numeric argument to binary operator
```


:::
:::


We cannot fix function `g`, because the problem does not occur there. We need to fix function `f` which triggers the call sequence! 

--

Use `traceback()`, which is often shown automatically in RStudio, and read it from bottom to top (the line at the top is where the error occurred)

-->
</section>
<section id="defensive-programming" class="slide level2 center">
<h2>Defensive Programming</h2>
<p><strong>Defensive Programming means preventing bugs from occurring in the first place!</strong></p>
<p>This involves:</p>
<h4 id="coding-style">1. Coding Style</h4>
<h4 id="condition-handling">2. Condition handling</h4>
</section>
<section id="defensive-programming-with-coding-style" class="slide level2 center">
<h2>1. Defensive Programming with <strong>Coding Style</strong></h2>
<!-- do this rather briefly as for the most part no new concepts; so we spend more time on the second tip for defensive programming: condition handling -->
</section>
<section class="slide level2 center">

<h3 id="writing-code">Writing code</h3>
<table class="caption-top">
<thead>
<tr class="header">
<th>Programming</th>
<th>Language</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Scripts</td>
<td>Essays</td>
</tr>
<tr class="even">
<td>Sections</td>
<td>Paragraphs</td>
</tr>
<tr class="odd">
<td>Lines Breaks</td>
<td>Sentences</td>
</tr>
<tr class="even">
<td>Parentheses</td>
<td>Punctuation</td>
</tr>
<tr class="odd">
<td>Functions</td>
<td>Verbs</td>
</tr>
<tr class="even">
<td>Variables</td>
<td>Nouns</td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2 center">

<h3 id="a-text-with-no-syntax">A text with no syntax</h3>
<p>Text taken from a speech given by Ronald Reagan in 1987, after the spacial Challenger exploded on take off. Reagan‚Äôs address: https://youtu.be/Qa7icmqgsow</p>
<p>‚Äúweve grown used to wonders in this century its hard to dazzle us but for 25 years the united states space program has been doing just that weve grown used to the idea of space and perhaps we forget that weve only just begun were still pioneers they the members of the Challenger crew were pioneers and i want to say something to the school children of America who were watching the live coverage of the shuttles takeoff i know it is hard to understand but sometimes painful things like this happen its all part of the process of exploration and discovery its all part of taking a chance and expanding mans horizons the future doesnt belong to the fainthearted it belongs to the brave the challenger crew was pulling us into the future and well continue to follow them the crew of the space shuttle challenger honored us by the manner in which they lived their lives we will never forget them nor the last time we saw them this morning as they prepared for the journey and waved goodbye and slipped the surly bonds of earth to touch the face of god‚Äù</p>
</section>
<section class="slide level2 center">

<h3 id="a-text-with-syntax">A text with syntax</h3>
<p>‚ÄúWe‚Äôve grown used to wonders in this century. It‚Äôs hard to dazzle us. But for 25 years the United States space program has been doing just that. We‚Äôve grown used to the idea of space, and perhaps we forget that we‚Äôve only just begun. We‚Äôre still pioneers. They, the members of the Challenger crew, were pioneers.</p>
<p>And I want to say something to the school children of America who were watching the live coverage of the shuttle‚Äôs takeoff. I know it is hard to understand, but sometimes painful things like this happen. It‚Äôs all part of the process of exploration and discovery. It‚Äôs all part of taking a chance and expanding man‚Äôs horizons. The future doesn‚Äôt belong to the fainthearted; it belongs to the brave. The Challenger crew was pulling us into the future, and we‚Äôll continue to follow them‚Ä¶.</p>
<p>The crew of the space shuttle Challenger honoured us by the manner in which they lived their lives. We will never forget them, nor the last time we saw them, this morning, as they prepared for the journey and waved goodbye and ‚Äòslipped the surly bonds of earth‚Äô to ‚Äòtouch the face of God.‚Äô‚Äù</p>
</section>
<section class="slide level2 center">

<h3 id="short-and-clear-object-names">Short and clear object names</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="co"># ideal (short and use of snake case)</span></span>
<span id="cb21-2"><a></a>day_one_month</span>
<span id="cb21-3"><a></a>day_one</span>
<span id="cb21-4"><a></a></span>
<span id="cb21-5"><a></a><span class="co"># not ideal</span></span>
<span id="cb21-6"><a></a>the_first_day_of_the_month</span>
<span id="cb21-7"><a></a>dayone</span>
<span id="cb21-8"><a></a>DayOneMonth</span>
<span id="cb21-9"><a></a>dm1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--

### Do not overwrite objects


```r
# examples of wrong code

T <- FALSE

x <- seq(from = 1, to = 10)
mean <- function(x) sum(x)
mean(x)
```
-->
</section>
<section class="slide level2 center">

<h3 id="break-your-lines-and-use-indentation">Break your lines and use indentation</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="co"># ideal</span></span>
<span id="cb22-2"><a></a>scdb_vote <span class="ot">&lt;-</span> scdb_vote <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a></a>  <span class="fu">mutate</span>(<span class="at">chief =</span> <span class="fu">factor</span>(chief,</span>
<span id="cb22-4"><a></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Jay"</span>, <span class="st">"Rutledge"</span>, <span class="st">"Ellsworth"</span>,</span>
<span id="cb22-5"><a></a>                                   <span class="st">"Marshall"</span>, <span class="st">"Taney"</span>, <span class="st">"Chase"</span>,</span>
<span id="cb22-6"><a></a>                                   <span class="st">"Waite"</span>, <span class="st">"Fuller"</span>, <span class="st">"White"</span>,</span>
<span id="cb22-7"><a></a>                                   <span class="st">"Taft"</span>, <span class="st">"Hughes"</span>, <span class="st">"Stone"</span>,</span>
<span id="cb22-8"><a></a>                                   <span class="st">"Vinson"</span>, <span class="st">"Warren"</span>, <span class="st">"Burger"</span>,</span>
<span id="cb22-9"><a></a>                                   <span class="st">"Rehnquist"</span>, <span class="st">"Roberts"</span>)))</span>
<span id="cb22-10"><a></a></span>
<span id="cb22-11"><a></a><span class="co"># not ideal</span></span>
<span id="cb22-12"><a></a>scdb_vote <span class="ot">&lt;-</span> <span class="fu">mutate</span>(scdb_vote, <span class="at">chief =</span> <span class="fu">factor</span>(chief, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Jay"</span>, <span class="st">"Rutledge"</span>, <span class="st">"Ellsworth"</span>, <span class="st">"Marshall"</span>, <span class="st">"Taney"</span>, <span class="st">"Chase"</span>, <span class="st">"Waite"</span>, <span class="st">"Fuller"</span>, <span class="st">"White"</span>, <span class="st">"Taft"</span>, <span class="st">"Hughes"</span>, <span class="st">"Stone"</span>, <span class="st">"Vinson"</span>, <span class="st">"Warren"</span>, <span class="st">"Burger"</span>, <span class="st">"Rehnquist"</span>, <span class="st">"Roberts"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Review the <a href="https://style.tidyverse.org/">tidyverse style guide</a> for more tips!</p>
</section>
<section class="slide level2 center">

<h3 id="calling-functions-that-have-the-same-name">Calling functions that have the same name</h3>
<p>Sometimes functions have the same name in different packages.</p>
<p>For example the <code>map()</code> function is defined both in the <code>purrr</code> package (to work with vectors and functions) and <code>maps</code> package (to create maps, something completely different!)</p>
<p>If you load both, by default R will use the function from the package most recently loaded which can lead to problems:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb23-2"><a></a><span class="fu">library</span>(maps)</span>
<span id="cb23-3"><a></a></span>
<span id="cb23-4"><a></a><span class="fu">map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2 center">

<h3 id="calling-functions-that-have-the-same-name-1">Calling functions that have the same name</h3>
<p>You can be intentional about which function to use with the <code>::</code> notation!</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb24-2"><a></a><span class="fu">library</span>(maps)</span>
<span id="cb24-3"><a></a></span>
<span id="cb24-4"><a></a>purrr<span class="sc">::</span><span class="fu">map</span>()    <span class="co"># use map() from the purrr library</span></span>
<span id="cb24-5"><a></a>maps<span class="sc">::</span><span class="fu">map</span>()     <span class="co"># use map() from the maps library</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or you can avoid loading a given package, and just load the specific function that you need from it:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb25-2"><a></a></span>
<span id="cb25-3"><a></a><span class="fu">map</span>()           <span class="co"># use map() from the purrr library</span></span>
<span id="cb25-4"><a></a>maps<span class="sc">::</span><span class="fu">map</span>()     <span class="co"># use map() from the maps library</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--

### Use functions correctly

See assigned reading ["How to read an R help page"](https://socviz.co/appendix.html#how-to-read-an-r-help-page)

-->
</section>
<section class="slide level2 center">

<h3 id="auto-formatting-in-r-studio">Auto-formatting in R Studio</h3>
<p>R Studio helps out with these issues:</p>
<ul>
<li>option 1: <code>Code &gt; Reformat Code</code> (Shift + Cmd/Ctrl + A)</li>
<li>option 2: <code>Code &gt; Reindent Lines</code> (Cmd/Ctrl + I)</li>
<li>option 3: install the package <a href="http://styler.r-lib.org/"><code>styler</code></a></li>
</ul>
<p>Open an R script, and try it out:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a> y<span class="ot">&lt;-</span><span class="dv">10</span></span>
<span id="cb26-2"><a></a>  <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb26-3"><a></a>x <span class="ot">&lt;-</span> <span class="st">"Too low"</span> }   </span>
<span id="cb26-4"><a></a><span class="cf">else</span> {</span>
<span id="cb26-5"><a></a>  x <span class="ot">&lt;-</span><span class="st">"Too high"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- * [This code example](/notes/style-guide/#exercise-style-this-code) -->
</section>
<section id="defensive-programming-with-condition-handling" class="slide level2 center">
<h2>2. Defensive Programming with <strong>Condition Handling</strong></h2>
<!-- need to teach try except! -->
</section>
<section class="slide level2 center">

<h3 id="three-types-of-conditions-to-handle">Three types of conditions to handle</h3>
<p>Coding style is one way to practice defensive programming and prevent bugs.</p>
<p>The second way is condition handling: <strong>set up our code in a way that it tells us if something is problematic.</strong></p>
<p>Three types of conditions:</p>
<ul>
<li>Errors (break your code)</li>
<li>Warnings</li>
<li>Messages</li>
</ul>
</section>
<section class="slide level2 center">

<h3 id="errors-incorrect-code-or-impossible-requests-in-r">Errors: Incorrect code or impossible requests in R</h3>
<p>For example, this <code>addition()</code> function takes two arguments and adds them together. The <code>if-else</code> condition checks if either <code>x</code> or <code>y</code> is not a number. If that‚Äôs TRUE, the <code>stop()</code> function triggers a error and notifies the user:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>addition <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb27-2"><a></a>  </span>
<span id="cb27-3"><a></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_numeric</span>(<span class="fu">c</span>(x, y))) {</span>
<span id="cb27-4"><a></a>    <span class="fu">stop</span>(<span class="st">"One of your inputs is not a number"</span>)</span>
<span id="cb27-5"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb27-6"><a></a>    <span class="fu">return</span>(x <span class="sc">+</span> y)</span>
<span id="cb27-7"><a></a>  }</span>
<span id="cb27-8"><a></a>}</span>
<span id="cb27-9"><a></a></span>
<span id="cb27-10"><a></a><span class="fu">addition</span>(<span class="dv">3</span>, <span class="st">"2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in is_numeric(c(x, y)): could not find function "is_numeric"</code></pre>
</div>
</div>
</section>
<section class="slide level2 center">

<h3 id="errors-incorrect-code-or-impossible-requests-in-r-1">Errors: Incorrect code or impossible requests in R</h3>
<p>A function can test for more than one error; but you need to check each of them separately with <code>if-else</code> statements. The function stops at the first error it encounters.</p>
<p>How to decide which errors to check for:</p>
<ol type="1">
<li>More conditional tests make the function more robust against incorrect uses</li>
<li>Think about who is going to use that function, and how frequently</li>
<li>Provide documentation to reduce the need for extensive testing</li>
</ol>
<p><em>Try-Except Blocks: Use try-except blocks to manage exceptions</em></p>
</section>
<section class="slide level2 center">

<h3 id="warnings-code-runs-but-may-have-potential-issues">Warnings: Code runs but may have potential issues</h3>
<p>For example, this code defines a function that takes as input <code>x</code> a probability value (between 0 and 1) and converts it to a natural logarithm value.</p>
<p>R will execute this code, but when the function is called with values outside the probability range, it gives a warning that says the result produces a ‚ÄúNaN‚Äù value (‚ÄúNot a Number‚Äù, impossible to calculate):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb29-2"><a></a>  <span class="fu">return</span>(<span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)))</span>
<span id="cb29-3"><a></a>}</span>
<span id="cb29-4"><a></a></span>
<span id="cb29-5"><a></a><span class="fu">logit</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NaN</code></pre>
</div>
</div>
</section>
<section class="slide level2 center">

<h3 id="warnings-code-runs-but-may-have-potential-issues-1">Warnings: Code runs but may have potential issues</h3>
<p>To fix this warning, we can‚Ä¶</p>
<p>Option 1: add a condition that signals and triggers an error instead than a warning. For example, if <code>x</code> is not between 0 and 1, then stop the code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb31-2"><a></a>  <span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> x <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb31-3"><a></a>    <span class="fu">stop</span>(<span class="st">'x not between 0 and 1'</span>)</span>
<span id="cb31-4"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb31-5"><a></a>    <span class="fu">return</span>(<span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)))</span>
<span id="cb31-6"><a></a>    }</span>
<span id="cb31-7"><a></a>}</span>
<span id="cb31-8"><a></a></span>
<span id="cb31-9"><a></a><span class="fu">logit</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in logit(-1): x not between 0 and 1</code></pre>
</div>
</div>
<!--

## Warnings

Same code of the previous slide, written more compactly:


::: {.cell}
::: {.cell-output .cell-output-error}

```
Error in logit(-1): x not between 0 and 1
```


:::
:::


Notice here we can write `if` and the condition one the same line without the `{}` and still preserve code legibility of this single `if` statement; we can also remove `return`

-->
</section>
<section class="slide level2 center">

<h3 id="warnings-code-runs-but-may-have-potential-issues-2">Warnings: Code runs but may have potential issues</h3>
<p>Option 2: To avoid stopping the code, we can also fix a warning without triggering an error. For example, we can check if <code>x</code> is outside the given range; if so, replace it with a missing value and trigger a warning if <code>x</code> is a missing value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-2"><a></a>  x <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> x <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb33-3"><a></a>               <span class="cn">NA_real_</span>,</span>
<span id="cb33-4"><a></a>               x)</span>
<span id="cb33-5"><a></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(x)) {</span>
<span id="cb33-6"><a></a>    <span class="fu">warning</span>(<span class="st">'x not between 0 and 1'</span>) </span>
<span id="cb33-7"><a></a>    <span class="fu">return</span>(<span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)))</span>
<span id="cb33-8"><a></a>    }</span>
<span id="cb33-9"><a></a>}</span>
<span id="cb33-10"><a></a></span>
<span id="cb33-11"><a></a><span class="fu">logit</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section class="slide level2 center">

<h3 id="messages-informative-notices">Messages: Informative notices</h3>
<p>Messages do not indicate that something is wrong, but provide useful info to the user.</p>
<p>For example, here we are plotting with <code>geom_smooth()</code> which automatically decides which smoothing algorithm to use (default is <code>gam</code> based on sample size):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-2"><a></a></span>
<span id="cb35-3"><a></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb35-4"><a></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb35-5"><a></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="14-slides_files/figure-revealjs/unnamed-chunk-20-1.png" style="width:35.0%" class="r-stretch"></section>
<section class="slide level2 center">

<h3 id="messages-informative-notices-1">Messages: Informative notices</h3>
<p>To write a message in your code, do not use the <code>print()</code> function, but the <code>message()</code> function‚Äù</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>demo_message <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">message</span>(<span class="st">"This is a message"</span>)</span>
<span id="cb36-2"><a></a><span class="fu">demo_message</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also suppress a message with <code>suppressMessages()</code> but this won‚Äôt work if you create a message using <code>print()</code>:</p>
</section>
<section id="to-print-these-slides-as-pdf" class="slide level2 center">
<h2>To print these slides as pdf</h2>
<p>Click on the icon bottom-right corner &gt; Tools &gt; PDF Export Mode &gt; Print as a Pdf</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>