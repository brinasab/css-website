<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="Sabrina Nardin, Fall 2025">
  <title>css-website ‚Äì Computing for the Social Sciences: Lecture 6</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-864c5404f4710dceefb0a9fe440f50a1.css">
  <link rel="stylesheet" href="../style/styles.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Computing for the Social Sciences: Lecture 6</h1>
  <p class="subtitle">Topics: Deep Dive into dplyr &amp; Factors in R</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Sabrina Nardin, Fall 2025 
</div>
</div>
</div>

</section>
<section id="agenda" class="title-slide slide level1 center">
<h1>Agenda</h1>
<div class="agenda-list">
<ol type="1">
<li>Review and expand our knowledge of dplyr for data manipulation</li>
<li>Define and use Factors in R</li>
</ol>
</div>
<p><span style="font-size: 0.8em; color: #666;"> <em>Slides last updated on <strong><code>r format(Sys.Date(), '%B %d, %Y')</code></strong>. Slides authored by Sabrina Nardin. AI used to polish slides style and fix typos.</em> </span></p>
<!-- 
Changes needed: Add more formal factor explanation (check Fall24 slides) as I cut it for CSP Sum25. Add more dplyr examples here. Do live coding but make it interactive compared to Fall24. Take the in-class exercise from lecture 4: use task 2 to teach factors and task 4 for more dplyr (For Fall25: adjust CSP Sum25 lecture 4 slides accordingly and move that part here). 
-->
</section>

<section>
<section id="deep-dive-into-dplyr" class="title-slide slide level1 center">
<h1>1. Deep dive into dplyr</h1>

</section>
<section id="most-important-dplyr-functions-definitions" class="slide level2 center">
<h2>Most Important dplyr Functions: Definitions</h2>
<table class="caption-top">
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th><code>function()</code></th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>select()</code></td>
<td>Chooses specific columns</td>
</tr>
<tr class="even">
<td><code>rename()</code></td>
<td>Renames columns</td>
</tr>
<tr class="odd">
<td><code>relocate()</code></td>
<td>Reorders columns</td>
</tr>
<tr class="even">
<td><code>filter()</code></td>
<td>Selects rows based on values on columns</td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>Reorders rows based on values in specified columns</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>Adds new columns or modifies existing ones</td>
</tr>
<tr class="odd">
<td><code>distinct()</code></td>
<td>Returns unique rows based on columns</td>
</tr>
<tr class="even">
<td><code>group_by()</code></td>
<td>Groups the data by one or more variables for grouped operations</td>
</tr>
<tr class="odd">
<td><code>count()</code></td>
<td>Counts observations by group</td>
</tr>
<tr class="even">
<td><code>summarize()</code></td>
<td>Reduces each group to a single row using summary statistics (e.g., mean, sum, n)</td>
</tr>
<tr class="odd">
<td><code>across()</code></td>
<td>Applies the same operation to multiple columns at once</td>
</tr>
</tbody>
</table>
</section>
<section id="most-important-dplyr-functions-tips-to-rememeber-and-examples" class="slide level2 center">
<h2>Most important dplyr Functions: Tips to Rememeber and Examples</h2>
<table class="caption-top">
<colgroup>
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 88%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Focus</th>
<th style="text-align: left;">Concept</th>
<th style="text-align: left;">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Columns</strong></td>
<td style="text-align: left;">Structure</td>
<td style="text-align: left;"><code>select()</code> chooses specific columns ‚Äî <code>select(penguins, species, island)</code><br><code>rename()</code> renames columns ‚Äî <code>rename(penguins, flip_mm = flipper_length_mm)</code><br><code>relocate()</code> reorders columns ‚Äî <code>relocate(penguins, island, .before = species)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rows</strong></td>
<td style="text-align: left;">Filtering &amp; sorting</td>
<td style="text-align: left;"><code>filter()</code> selects rows by values ‚Äî <code>filter(penguins, species == "Adelie")</code><br><code>arrange()</code> orders rows by column values ‚Äî <code>arrange(penguins, desc(body_mass_g))</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Values</strong></td>
<td style="text-align: left;">Transformation</td>
<td style="text-align: left;"><code>mutate()</code> adds or changes columns ‚Äî <code>mutate(penguins, flip_cm = flipper_length_mm / 10)</code><br><code>distinct()</code> keeps unique rows ‚Äî <code>distinct(penguins, species, island)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Groups</strong></td>
<td style="text-align: left;">Aggregation</td>
<td style="text-align: left;"><code>group_by()</code> defines groups ‚Äî <code>group_by(penguins, species)</code><br><code>count()</code> counts rows per group ‚Äî <code>count(penguins, island)</code> <br> <code>summarize()</code> creates summaries per group ‚Äî <code>summarize(penguins, avg_flip = mean(flipper_length_mm, na.rm = TRUE))</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Across columns</strong></td>
<td style="text-align: left;">Automation</td>
<td style="text-align: left;"><code>across()</code> applies an operation to multiple columns ‚Äî <code>summarize(across(ends_with("_mm"), mean, na.rm = TRUE))</code></td>
</tr>
</tbody>
</table>
<p><br></p>
<div style="font-size:0.8em; color:#666; text-align:center; margin-top:0.5em;">
Data flows top ‚Üí bottom just like in a pipeline: penguins |&gt; select() |&gt; filter() |&gt; group_by() |&gt; summarize()
</div>
</section>
<section id="penguins-data" class="slide level2 center">
<h2>Penguins data</h2>
<p>Load libraries and data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb1-3"><a></a><span class="fu">data</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explore data (pick one of these):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">rbind</span>(<span class="fu">head</span>(penguins, <span class="dv">5</span>), <span class="fu">tail</span>(penguins, <span class="dv">5</span>))</span>
<span id="cb2-2"><a></a><span class="fu">glimpse</span>(penguins)</span>
<span id="cb2-3"><a></a><span class="fu">str</span>(penguins)</span>
<span id="cb2-4"><a></a><span class="fu">summary</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="select-extracts-variables-operates-on-columns" class="slide level2 center">
<h2>select() extracts variables, operates on columns</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="co"># select two specific variables using their names</span></span>
<span id="cb3-2"><a></a><span class="fu">select</span>(penguins, species, body_mass_g)</span>
<span id="cb3-3"><a></a></span>
<span id="cb3-4"><a></a><span class="co"># select all variables except two using the minus sign</span></span>
<span id="cb3-5"><a></a><span class="fu">select</span>(penguins, <span class="sc">-</span>year, <span class="sc">-</span>island)</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a><span class="co"># select a range of contiguous/adjacent variables</span></span>
<span id="cb3-8"><a></a><span class="fu">select</span>(penguins, species<span class="sc">:</span>bill_length_mm)</span>
<span id="cb3-9"><a></a></span>
<span id="cb3-10"><a></a><span class="co"># select all variables except a range of contiguous ones</span></span>
<span id="cb3-11"><a></a><span class="fu">select</span>(penguins, <span class="sc">-</span>(species<span class="sc">:</span>island))</span>
<span id="cb3-12"><a></a></span>
<span id="cb3-13"><a></a><span class="co"># select all variables that start with</span></span>
<span id="cb3-14"><a></a><span class="fu">select</span>(penguins, <span class="fu">starts_with</span>(<span class="st">"bill"</span>))</span>
<span id="cb3-15"><a></a></span>
<span id="cb3-16"><a></a><span class="co"># select all variables that end with</span></span>
<span id="cb3-17"><a></a><span class="fu">select</span>(penguins, <span class="fu">ends_with</span>(<span class="st">"mm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="filter-extract-observations-operates-on-rows" class="slide level2 center">
<h2>filter() extract observations, operates on rows</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># check variable values</span></span>
<span id="cb4-2"><a></a><span class="fu">levels</span>(penguins<span class="sc">$</span>species) </span>
<span id="cb4-3"><a></a><span class="fu">unique</span>(penguins<span class="sc">$</span>species)</span>
<span id="cb4-4"><a></a><span class="fu">count</span>(penguins, species)</span>
<span id="cb4-5"><a></a>penguins <span class="sc">|&gt;</span> <span class="fu">count</span>(penguins, species)</span>
<span id="cb4-6"><a></a></span>
<span id="cb4-7"><a></a><span class="co"># filter by island and species</span></span>
<span id="cb4-8"><a></a><span class="fu">filter</span>(penguins, island <span class="sc">==</span> <span class="st">"Biscoe"</span>, species <span class="sc">==</span> <span class="st">"Gentoo"</span>)</span>
<span id="cb4-9"><a></a><span class="fu">filter</span>(penguins, (island <span class="sc">==</span> <span class="st">"Biscoe"</span> <span class="sc">&amp;</span> species <span class="sc">==</span> <span class="st">"Gentoo"</span>))</span>
<span id="cb4-10"><a></a></span>
<span id="cb4-11"><a></a><span class="co"># filter by multiple conditions</span></span>
<span id="cb4-12"><a></a><span class="fu">filter</span>(penguins, species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Gentoo"</span>), island <span class="sc">!=</span> <span class="st">"Biscoe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="select-plus-filter" class="slide level2 center">
<h2>select() plus filter()</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a></a>  <span class="fu">select</span>(species, sex, year, island) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a></a>  <span class="fu">filter</span>(island <span class="sc">==</span> <span class="st">"Torgersen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="arrange-changes-order-of-observations" class="slide level2 center">
<h2>arrange() changes order of observations</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>penguins <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(bill_length_mm))</span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a></a>  <span class="fu">select</span>(species, <span class="fu">contains</span>(<span class="st">"bill"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(bill_length_mm)) </span>
<span id="cb6-7"><a></a></span>
<span id="cb6-8"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a></a>  <span class="fu">select</span>(species, <span class="fu">contains</span>(<span class="st">"bill"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(species), bill_length_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="relocate-changes-order-of-variable" class="slide level2 center">
<h2>relocate() changes order of variable</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>penguins <span class="sc">|&gt;</span> <span class="fu">relocate</span>(year, sex)</span>
<span id="cb7-2"><a></a></span>
<span id="cb7-3"><a></a>penguins <span class="sc">|&gt;</span> <span class="fu">relocate</span>(year, <span class="at">.after =</span> island)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="mutate-modify-or-create-new-columns" class="slide level2 center">
<h2>mutate() modify or create new columns</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>penguins <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">bill_ratio =</span> bill_length_mm <span class="sc">/</span> bill_depth_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note: it does not reduce the dimensions of the original data https://dplyr.tidyverse.org/reference/mutate.html</p>
</section>
<section id="summarize-summary-of-data" class="slide level2 center">
<h2>summarize() summary of data</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a></a>  <span class="fu">summarize</span>(<span class="at">body_mass_mean =</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-3"><a></a>            <span class="at">body_mass_sd =</span> <span class="fu">sd</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-4"><a></a>            <span class="at">n =</span> <span class="fu">n</span>())  <span class="co"># n = nrow(penguins)</span></span>
<span id="cb9-5"><a></a></span>
<span id="cb9-6"><a></a>penguins <span class="sc">|</span> </span>
<span id="cb9-7"><a></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Gentoo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a></a>  <span class="fu">summarize</span>(<span class="at">body_mass_mean =</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-9"><a></a>            <span class="at">body_mass_sd =</span> <span class="fu">sd</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-10"><a></a>            <span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note: collapses the original data to a smaller number of rows, you can use summarize to create all sort of summary statistics https://dplyr.tidyverse.org/reference/summarise.html</p>
</section>
<section id="group_by-aggregates-data-for-next-function" class="slide level2 center">
<h2>group_by() aggregates data for next function</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="co"># group by alone? not that useful</span></span>
<span id="cb10-2"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a></a>  <span class="fu">group_by</span>(island, sex)</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a><span class="co"># group by and count</span></span>
<span id="cb10-6"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a></a>  <span class="fu">group_by</span>(island, sex) <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a></a>  <span class="fu">count</span>()</span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a><span class="co"># group by and calculate mean body mass</span></span>
<span id="cb10-11"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a></a>  <span class="fu">group_by</span>(island, sex) <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a></a>  <span class="fu">summarize</span>(<span class="at">body_mass_mean =</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="count-counts-tot-obs.-by-group" class="slide level2 center">
<h2>count() counts tot obs. by group</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="co"># total penguins by sex without count</span></span>
<span id="cb11-2"><a></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a></a>  <span class="fu">group_by</span>(sex) <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb11-5"><a></a></span>
<span id="cb11-6"><a></a><span class="co"># with count</span></span>
<span id="cb11-7"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a></a>  <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="distinct-returns-unique-rows-based-on-given-columns" class="slide level2 center">
<h2>distinct() returns unique rows based on given columns</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co"># not too handy alone</span></span>
<span id="cb12-2"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a></a>  <span class="fu">distinct</span>()</span>
<span id="cb12-4"><a></a></span>
<span id="cb12-5"><a></a><span class="co"># better with specific columns</span></span>
<span id="cb12-6"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a></a>  <span class="fu">distinct</span>(species, island)</span>
<span id="cb12-8"><a></a></span>
<span id="cb12-9"><a></a><span class="co"># keep all columns in the resulting data frame</span></span>
<span id="cb12-10"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a></a>  <span class="fu">distinct</span>(species, island, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note: gives back a dataframe with only unique combinations of those columns https://dplyr.tidyverse.org/reference/distinct.html</p>
</section>
<section id="across" class="slide level2 center">
<h2>across()</h2>
<p>Examples with and without <code>across()</code> with numerical variables:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="co"># mean for a bunch of variables without across</span></span>
<span id="cb13-2"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-4"><a></a>    <span class="at">mean_bill_length_mm =</span> <span class="fu">mean</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-5"><a></a>    <span class="at">mean_bill_depth_mm =</span> <span class="fu">mean</span>(bill_depth_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-6"><a></a>    <span class="at">mean_flipper_length_mm =</span> <span class="fu">mean</span>(flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-7"><a></a>    <span class="at">mean_body_mass_g =</span> <span class="fu">mean</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-8"><a></a>  )</span>
<span id="cb13-9"><a></a></span>
<span id="cb13-10"><a></a><span class="co"># same operation with across</span></span>
<span id="cb13-11"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-13"><a></a>    <span class="fu">across</span>(</span>
<span id="cb13-14"><a></a>      <span class="fu">c</span>(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g), </span>
<span id="cb13-15"><a></a>      <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># function(x) mean(x, na.rm = TRUE)</span></span>
<span id="cb13-16"><a></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="across-1" class="slide level2 center">
<h2>across()</h2>
<p>Examples with and without <code>across()</code> with categorical variables:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="co"># number of distinct entries for columns without across</span></span>
<span id="cb14-2"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a></a>  <span class="fu">summarise</span>(<span class="at">distinct_species =</span> <span class="fu">n_distinct</span>(species),</span>
<span id="cb14-4"><a></a>            <span class="at">distinct_island =</span> <span class="fu">n_distinct</span>(island),</span>
<span id="cb14-5"><a></a>            <span class="at">distinct_year =</span> <span class="fu">n_distinct</span>(year))</span>
<span id="cb14-6"><a></a></span>
<span id="cb14-7"><a></a><span class="co"># number of distinct entries for columns with across</span></span>
<span id="cb14-8"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(species, island, year), </span>
<span id="cb14-10"><a></a>                   n_distinct))</span>
<span id="cb14-11"><a></a></span>
<span id="cb14-12"><a></a><span class="co"># the opposite</span></span>
<span id="cb14-13"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb14-14"><a></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(species, island, year), </span>
<span id="cb14-15"><a></a>                   n_distinct))</span>
<span id="cb14-16"><a></a></span>
<span id="cb14-17"><a></a><span class="co"># everything</span></span>
<span id="cb14-18"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb14-19"><a></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), </span>
<span id="cb14-20"><a></a>                   n_distinct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="factors-in-r" class="title-slide slide level1 center middle">
<h1>2. Factors in R</h1>

</section>
<section id="what-are-factors-in-r" class="slide level2 center">
<h2>What are Factors in R?</h2>
<p><strong>A factor is a specific data structure in R.</strong></p>
<p>To understand factors, and why we use them, we need to start from categorical data or variables: variables with a fixed set of possible values. For example, the variable <code>species</code> in the <code>penguins</code> data can only take one of three values (‚ÄúAdelie‚Äù, ‚ÄúChinstrap‚Äù, or ‚ÄúGentoo‚Äù).</p>
</section>
<section id="what-are-factors-in-r-1" class="slide level2 center">
<h2>What are Factors in R?</h2>
<div title="R Data Structures to Store Categorical Data">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>R Data Structures to Store Categorical Data</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p><strong>Character vector (default):</strong> Data type for storing categorical data as plain strings (e.g., variable <code>months</code> with ‚ÄúJan‚Äù, ‚ÄúFeb‚Äù, ‚ÄúMar‚Äù, etc.). Values have no built-in order or grouping.</p></li>
<li><p><strong>Numeric vector (occasionally):</strong> Sometimes these are used to store categorical data as numbers (e.g., variable <code>months</code> with 1, 2, 3), but lacks category labels or order.</p></li>
<li><p><strong>Factor (preferred when order matters):</strong> Data type for storing categorical data with defined levels. Values can be ordered according to the researcher needs.</p></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="real-world-examples-of-categorical-data" class="slide level2 center">
<h2>Real-world examples of categorical data</h2>
<p>You often need factors in R. Why? They let you sort categorical variables in <strong>your desired order</strong> whether that order reflects a natural sequence or you define it for analytic purposes. Examples:</p>
<ul>
<li>Months of the year (January ‚Üí December)</li>
<li>Likert scales (Strongly Agree ‚Üí Strongly Disagree)</li>
<li>Educational attainment levels (High School ‚Üí Graduate)</li>
<li>Political parties</li>
<li>Race/ethnicity categories</li>
<li>Institution type</li>
<li>Movies categories</li>
<li>Etc.</li>
</ul>
</section>
<section id="why-use-factors" class="slide level2 center">
<h2>Why use Factors?</h2>
<p>Let‚Äôs define a character vector with four months and sort it.<br>
Copy and paste this code in R and run it. What do you notice?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># Define</span></span>
<span id="cb15-2"><a></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dec"</span>, <span class="st">"Apr"</span>, <span class="st">"Jan"</span>, <span class="st">"Mar"</span>)</span>
<span id="cb15-3"><a></a></span>
<span id="cb15-4"><a></a><span class="co"># Check</span></span>
<span id="cb15-5"><a></a>x1</span>
<span id="cb15-6"><a></a><span class="fu">class</span>(x1)</span>
<span id="cb15-7"><a></a></span>
<span id="cb15-8"><a></a><span class="co"># Sort</span></span>
<span id="cb15-9"><a></a><span class="fu">sort</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-use-factors-1" class="slide level2 center">
<h2>Why use Factors?</h2>
<p>From the previous example we observe that <strong>by default, R sorts character vectors alphabetically!</strong></p>
<p>However, alphabetical order isn‚Äôt ideal to sort months. We usually want them sorted in chronological order. To do that in R, we need factors.</p>
<div class="callout callout-none no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>In the next slides, we learn two cases that you will likely encounter when working with factors:</p>
<ol type="1">
<li>Converting a <strong>Character Vector to a Factor</strong> (most common)</li>
<li>Converting a <strong>Numeric Vector to a Factor</strong> (sometimes needed when categories are stored as numbers)</li>
</ol>
</div>
</div>
</div>
</section>
<section id="converting-a-character-vector-to-a-factor" class="slide level2 center">
<h2>1. Converting a Character Vector to a Factor</h2>
<p>Often categorical data is stored in character vectors. Character vectors sort alphabetically by default. To change the order, convert them to a factor using <code>factor()</code> and assign the desired <strong>levels.</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="co"># Character vector with month names</span></span>
<span id="cb16-2"><a></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dec"</span>, <span class="st">"Apr"</span>, <span class="st">"Jan"</span>, <span class="st">"Mar"</span>)</span>
<span id="cb16-3"><a></a><span class="fu">class</span>(x1)</span>
<span id="cb16-4"><a></a></span>
<span id="cb16-5"><a></a><span class="co"># Define all set of possibile levels in desired order</span></span>
<span id="cb16-6"><a></a>month_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>, </span>
<span id="cb16-7"><a></a>                  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)</span>
<span id="cb16-8"><a></a></span>
<span id="cb16-9"><a></a><span class="co"># Convert to factor using those levels</span></span>
<span id="cb16-10"><a></a>y1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1, <span class="at">levels =</span> month_levels)</span>
<span id="cb16-11"><a></a></span>
<span id="cb16-12"><a></a><span class="co"># Check</span></span>
<span id="cb16-13"><a></a>y1</span>
<span id="cb16-14"><a></a><span class="fu">class</span>(y1)</span>
<span id="cb16-15"><a></a><span class="fu">levels</span>(y1)</span>
<span id="cb16-16"><a></a></span>
<span id="cb16-17"><a></a><span class="co"># Compare sorting</span></span>
<span id="cb16-18"><a></a><span class="fu">sort</span>(x1)  <span class="co"># Alphabetical</span></span>
<span id="cb16-19"><a></a><span class="fu">sort</span>(y1)  <span class="co"># Chronological (by factor levels)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- 
# SHORTER CODE

# Character vector with month names
x1 <- c("Dec", "Apr", "Jan", "Mar")
class(x1)

# Convert to factor using levels
y1 <- factor(x1, levels = c("Jan", "Mar", "Apr", "Dec"))

# if you pick another order, it will follow that one!
-->
</section>
<section id="converting-a-numeric-vector-to-a-factor" class="slide level2 center">
<h2>2. Converting a Numeric Vector to a Factor</h2>
<p>Sometimes categorical data is stored as numbers (e.g., months as 1, 2, 12) in numeric vectors. To convert them to a factor with <code>factor()</code>, you need to specify <strong>both levels and labels.</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co"># Numeric vector with values representing months</span></span>
<span id="cb17-2"><a></a>x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb17-3"><a></a><span class="fu">class</span>(x2)</span>
<span id="cb17-4"><a></a></span>
<span id="cb17-5"><a></a><span class="co"># Define all set of possibile numeric values we expect</span></span>
<span id="cb17-6"><a></a>month_levels <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb17-7"><a></a></span>
<span id="cb17-8"><a></a><span class="co"># Define all labels we want to show for each value</span></span>
<span id="cb17-9"><a></a>month_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>, </span>
<span id="cb17-10"><a></a>                  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>) </span>
<span id="cb17-11"><a></a></span>
<span id="cb17-12"><a></a><span class="co"># Convert to factor using levels and labels</span></span>
<span id="cb17-13"><a></a>y2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x2, </span>
<span id="cb17-14"><a></a>            <span class="at">levels =</span> month_levels,</span>
<span id="cb17-15"><a></a>            <span class="at">labels =</span> month_labels)</span>
<span id="cb17-16"><a></a></span>
<span id="cb17-17"><a></a><span class="co"># Check</span></span>
<span id="cb17-18"><a></a>y2</span>
<span id="cb17-19"><a></a><span class="fu">class</span>(y2)</span>
<span id="cb17-20"><a></a><span class="fu">levels</span>(y2)</span>
<span id="cb17-21"><a></a></span>
<span id="cb17-22"><a></a><span class="co"># Compare sorting</span></span>
<span id="cb17-23"><a></a><span class="fu">sort</span>(x2)  <span class="co"># Numeric</span></span>
<span id="cb17-24"><a></a><span class="fu">sort</span>(y2)  <span class="co"># Chronological (by factor levels)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- 
**Question:** Why we are defining all possible levels and labels when only four are needed here? It will work either way, but it's good practice to define the full set and order of categories.

# SHORTER CODE

# Define all labels we want to show for each value
month_labels <- c("Jan", "Mar", "Apr", "Dec") 

# Convert to factor using levels and labels
y2 <- factor(x2, 
             levels = x2,
             labels = month_labels)
-->
</section>
<section id="levels-and-labels-in-factors" class="slide level2 center">
<h2>Levels and Labels in Factors</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="levels">Levels</h3>
<ul>
<li>Define the set of distinct categories a factor can take<br>
</li>
<li>Use to tell R the <strong>order</strong> of each category</li>
<li>Use <strong>only levels</strong> when your input data is already human readable, as in our first example (e.g., <code>"Jan"</code>, <code>"Feb"</code>, etc.)</li>
</ul>
</div><div class="column" style="width:50%;">
<h3 id="labels">Labels</h3>
<ul>
<li>Define optional names for each distinct category</li>
<li>Use to tell R <strong>what to display</strong> for each category<br>
</li>
<li>Use <strong>labels and levels</strong> when your input data uses codes, as in our second example (e.g., <code>1</code> to mean <code>"Jan"</code>), and you want to display more human readable labels. Labels are matched to levels, not to raw values</li>
</ul>
</div></div>
</section>
<section id="levels-and-labels-in-factors-1" class="slide level2 center">
<h2>Levels and Labels in Factors</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="when-you-input-is-a-character-vector">When you input is a Character Vector</h3>
<p><strong>Example values</strong>: <code>"Jan"</code>, <code>"May"</code>, <code>"Oct"</code></p>
<ul>
<li>Already human-readable</li>
<li>(Often) only want to control the order<br>
</li>
<li>Convert to factor using only <strong><code>levels</code></strong> to order and label</li>
<li>Example: <code>"May"</code> stays <code>"May"</code></li>
</ul>
</div><div class="column" style="width:50%;">
<h3 id="when-you-input-is-a-numeric-vector">When you input is a Numeric Vector</h3>
<p><strong>Example values</strong>: <code>1</code>, <code>7</code>, <code>12</code></p>
<ul>
<li>Not already human-readable</li>
<li>Want to control the order &amp; add readable labels</li>
<li>Convert to factor using <strong><code>levels</code></strong> to order &amp; <strong><code>labels</code></strong> to label</li>
<li>Example: <code>1</code> becomes <code>"Jan"</code>, <code>2</code> becomes <code>"Feb"</code>, etc.</li>
</ul>
</div></div>
<!--
## Summary of Levels and Labels in Factors


| **Type**           | **What It Represents**              | **Levels** ‚Äî Store & Sort By                 | **Labels** ‚Äî Display Names                    | **Example**                                              |
|--------------------|-------------------------------------|------------------------------------------------|------------------------------------------------|----------------------------------------------------------|
| Character Vector   | Categorical names (`"Jan"`)   | To control order (e.g., Jan, Feb, ..., Dec)   | Not needed ‚Äî values are already readable       | `factor(x1, levels = month_names)`                      |
| Numeric Vector     | Coded categories (`1`)   | To match internal codes (e.g., 1 = Jan,..., 12 = Dec) | To assign readable labels to codes (e.g., "Jan", ...) | `factor(x2, levels = 1:12, labels = month_names)`       |

-->
</section>
<section id="levels-and-labels-in-factors-examples" class="slide level2 center">
<h2>Levels and Labels in Factors: Examples</h2>
<p>Before you run the code below in R, take a moment to predict the output. What do you expect each code chunk to return, and why?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="co"># Example 1 with Input as Character Vector</span></span>
<span id="cb18-2"><a></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="st">"Medium"</span>, <span class="st">"Low"</span>)</span>
<span id="cb18-3"><a></a>b <span class="ot">&lt;-</span> <span class="fu">factor</span>(a, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>))</span>
<span id="cb18-4"><a></a>b</span>
<span id="cb18-5"><a></a><span class="fu">sort</span>(b)</span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a><span class="co"># Example 2 with Input as Numeric vector</span></span>
<span id="cb18-8"><a></a>i <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb18-9"><a></a>j <span class="ot">&lt;-</span> <span class="fu">factor</span>(i, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb18-10"><a></a>               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>))</span>
<span id="cb18-11"><a></a>j</span>
<span id="cb18-12"><a></a><span class="fu">sort</span>(j)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--
# Note on Example 1

If you write labels rather then levels you get a wrong output!
# you can use both levels and labels also here but not needed
c <- factor(a, levels = c("Low", "Medium", "High"),
               labels = c("L", "M", "H"))
               
- Clear mapping: 1 ‚Üí "Low", 2 ‚Üí "Medium", 3 ‚Üí "High"
- Labels are matched to levels, not to raw values
-->
</section>
<section id="practice-character-vector-factor" class="slide level2 center">
<h2>üíª Practice: Character Vector ‚Üí Factor</h2>
<p>You are working with a <strong>character vector</strong>. Your goal is to convert it into a factor so, when you sort it, months follow their chronological order rather than alphabetical order.</p>
<p>The code below is not correct. Run it in R, identify the problem, and fix it.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="co"># Define a character vector representing months</span></span>
<span id="cb19-2"><a></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dec"</span>, <span class="st">"Apr"</span>, <span class="st">"Jan"</span>, <span class="st">"Mar"</span>)</span>
<span id="cb19-3"><a></a><span class="fu">class</span>(m)</span>
<span id="cb19-4"><a></a></span>
<span id="cb19-5"><a></a><span class="co"># Attempt</span></span>
<span id="cb19-6"><a></a>mf <span class="ot">&lt;-</span> <span class="fu">factor</span>(m, </span>
<span id="cb19-7"><a></a>            <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>),</span>
<span id="cb19-8"><a></a>            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb19-9"><a></a>                       <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb19-10"><a></a>mf</span>
<span id="cb19-11"><a></a></span>
<span id="cb19-12"><a></a><span class="co"># Compare sorting</span></span>
<span id="cb19-13"><a></a><span class="fu">sort</span>(m)  </span>
<span id="cb19-14"><a></a><span class="fu">sort</span>(mf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="solution-character-vector-factor" class="slide level2 center">
<h2>Solution: Character Vector ‚Üí Factor</h2>
<p>The input vector is made of characters (‚ÄúJan‚Äù, ‚ÄúFeb‚Äù‚Ä¶) but the levels provided are numbers (1‚Äì12). R can‚Äôt match them: levels must match the type of your input data.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>mf <span class="ot">&lt;-</span> <span class="fu">factor</span>(m, </span>
<span id="cb20-2"><a></a>             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb20-3"><a></a>                        <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb20-4"><a></a>mf</span>
<span id="cb20-5"><a></a><span class="fu">sort</span>(mf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="practice-numeric-vector-factor" class="slide level2 center">
<h2>üíª Practice: Numeric Vector ‚Üí Factor</h2>
<p>You are working with a <strong>numeric vector</strong> representing months as numbers. Your goal is the same: convert it into a factor, so when you sort it, months are in chronological order.</p>
<p>None of the attempts below is correct. Run each in R, explain why each does not work, and write one solution that works.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="co"># Define a numeric vector representing months</span></span>
<span id="cb21-2"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb21-3"><a></a><span class="fu">class</span>(x)</span>
<span id="cb21-4"><a></a></span>
<span id="cb21-5"><a></a><span class="co"># Attempt 1</span></span>
<span id="cb21-6"><a></a>y1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> x,</span>
<span id="cb21-7"><a></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb21-8"><a></a>                </span>
<span id="cb21-9"><a></a><span class="co"># Attempt 2</span></span>
<span id="cb21-10"><a></a>y2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>), </span>
<span id="cb21-11"><a></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb21-12"><a></a>              </span>
<span id="cb21-13"><a></a><span class="co"># Attempt 3</span></span>
<span id="cb21-14"><a></a>y3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb21-15"><a></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"Dec"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="solution-numeric-vector-factor" class="slide level2 center">
<h2>Solution: Numeric Vector ‚Üí Factor</h2>
<ul>
<li><p>Attempts 1 and 2: mismatch between the number of labels and the levels. R throws an error.</p></li>
<li><p>Attempt 3: R doesn‚Äôt throw an error, but the code is incorrect because it forces levels 1 to 4, even though the input vector has values like 12. Since 12 isn‚Äôt among the defined levels, it becomes <code>NA</code>, leading to incorrect matches.</p></li>
</ul>
<p>You can fix the code from the previous slide in the following ways:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="co"># Numeric vector representing months</span></span>
<span id="cb22-2"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb22-3"><a></a><span class="fu">class</span>(x)</span>
<span id="cb22-4"><a></a></span>
<span id="cb22-5"><a></a><span class="co"># Option 1 (reccomended)</span></span>
<span id="cb22-6"><a></a>month_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"June"</span>, <span class="st">"July"</span>, <span class="st">"Aug"</span>, <span class="st">"Sept"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)</span>
<span id="cb22-7"><a></a>month_levels <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)</span>
<span id="cb22-8"><a></a>y1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> month_levels,  </span>
<span id="cb22-9"><a></a>                <span class="at">labels =</span> month_labels)</span>
<span id="cb22-10"><a></a><span class="fu">class</span>(y1)</span>
<span id="cb22-11"><a></a></span>
<span id="cb22-12"><a></a><span class="co"># Option 2 (works but not reccomended, why?)</span></span>
<span id="cb22-13"><a></a>y2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">12</span>),</span>
<span id="cb22-14"><a></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"Dec"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--

Option 1: creates a factor with all 12 months as possible levels, even if only 4 are used. Best option because it preserves the full structure of the variable.

Option 2: only keeps levels that appear in the data. Correct but incomplete, fails if new values (e.g. 5) appear later.

If you don‚Äôt specify `levels`, R will use the unique values in the data ‚Äî so mismatches can lead to warnings or incorrect labeling. 

Tip: to avoid problems, specify both `levels` and `labels` explicitly.
-->
</section>
<section id="apply-these-concpets-to-a-dataframe-scorecard-example" class="slide level2 center">
<h2>Apply these concpets to a dataframe: scorecard example</h2>
<p>In most of your work, you deal with dataframes. Last week we worked with the <code>scorecard</code> data to practice <code>ggplot2</code>. Now we use the same data to see how we can use factors in a dataframe.</p>
<p>Load libraries and data:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-2"><a></a><span class="fu">library</span>(rcis)</span>
<span id="cb23-3"><a></a><span class="fu">data</span>(scorecard)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explore data:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">glimpse</span>(scorecard)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-plot-the-total-number-of-schools-in-the-u.s.-by-school-type" class="slide level2 center">
<h2>Example: Plot the total number of schools in the U.S. by school type</h2>
<p>This is the same question we did in class (see in-class tutorial, lecture 4)</p>
<p>Since <code>type</code> is a categorical varialbe, we use bar chart, which takes each category <code>"Public"</code>, <code>"Private nonprofit"</code>, <code>"Private for profit"</code> and automatically applies a frequency count to aggregate the data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">ggplot</span>(scorecard, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> type)) <span class="sc">+</span></span>
<span id="cb25-2"><a></a>  <span class="fu">geom_bar</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<h4 id="our-goal-reorder-the-bars">Our goal: reorder the bars!</h4>
<p><br></p>
</section>
<section id="method-1-reorder-bars-manually-with-factor" class="slide level2 center">
<h2>Method 1: Reorder bars manually with <em>factor()</em></h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>scorecard <span class="ot">&lt;-</span> scorecard <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type,</span>
<span id="cb26-3"><a></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Public"</span>, <span class="st">"Private nonprofit"</span>, <span class="st">"Private for-profit"</span>)))</span>
<span id="cb26-4"><a></a></span>
<span id="cb26-5"><a></a><span class="fu">ggplot</span>(scorecard, <span class="fu">aes</span>(<span class="at">x =</span> type)) <span class="sc">+</span></span>
<span id="cb26-6"><a></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method gives you full control of the order by manually defining factor levels.</p>
<p>Remember to check the column type (character or numeric) before transforming to factor. Use mutate since we are working on column of a dataframe (and not a standalone vector like in the previous examples).</p>
</section>
<section id="method-2-reorder-the-bars-using-tidyverse-fct_relevel" class="slide level2 center">
<h2>Method 2: Reorder the bars using tidyverse <em>fct_relevel()</em></h2>
<p><a href="https://forcats.tidyverse.org/reference/fct_relevel.html"><code>fct_relevel()</code></a>: allows to reorder factor levels by hand</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>scorecard <span class="ot">&lt;-</span> scorecard <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">fct_relevel</span>(type, </span>
<span id="cb27-3"><a></a>                           <span class="st">"Private, nonprofit"</span>, <span class="st">"Public"</span>, <span class="st">"Private, for-profit"</span>))</span>
<span id="cb27-4"><a></a>                                  </span>
<span id="cb27-5"><a></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> type)) <span class="sc">+</span></span>
<span id="cb27-6"><a></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="method-3-reorder-the-bars-using-tidyverse-fct_infreq" class="slide level2 center">
<h2>Method 3: Reorder the bars using tidyverse <em>fct_infreq()</em></h2>
<p><a href="https://forcats.tidyverse.org/reference/fct_inorder.html"><code>fct_infreq()</code></a> sorts bars automatically by how common each category is (most to least frequent)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>scorecard <span class="ot">&lt;-</span> scorecard <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">fct_infreq</span>(type))</span>
<span id="cb28-3"><a></a></span>
<span id="cb28-4"><a></a><span class="fu">ggplot</span>(scorecard, <span class="fu">aes</span>(<span class="at">x =</span> type)) <span class="sc">+</span></span>
<span id="cb28-5"><a></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-forcats-package" class="slide level2 center">
<h2>The ‚Äúforcats‚Äù Package</h2>
<div title="Using factor() or a function from forcats?">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Using factor() or a function from forcats?</strong></p>
</div>
<div class="callout-content">
<p>The function <code>factor()</code> is the base R way to create and manage factors. It‚Äôs a foundational tool: worth understanding because many R functions depend on it!</p>
<p>Since working with factors is key in R, people developed a specific package called <code>forcats</code> (part of the <code>tidyverse</code>) provides a set of simpler but powerful functions for working with categorical data.</p>
<p>You can use these, but knowing <code>factor()</code> helps you understand what‚Äôs happening behind the scenes.</p>
</div>
</div>
</div>
</div>
</section>
<section id="the-forcats-package-1" class="slide level2 center">
<h2>The ‚Äúforcats‚Äù Package</h2>
<table class="caption-top">
<colgroup>
<col style="width: 15%">
<col style="width: 42%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>What it does</th>
<th>When to use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>fct_relevel()</code></td>
<td>Manually sets the order of levels</td>
<td>When you need full manual control (similar to <code>factor(..., levels = ...)</code> in base R)</td>
</tr>
<tr class="even">
<td><code>fct_infreq()</code></td>
<td>Reorders factor levels by frequency (most to least common)</td>
<td>When you want categories ordered by how often they appear</td>
</tr>
<tr class="odd">
<td><code>fct_reorder()</code></td>
<td>Reorders levels based on another variable (e.g., a numeric value)</td>
<td>Ideal for ordering bars by a summary statistic in <code>ggplot2</code></td>
</tr>
</tbody>
</table>
<p>For more functions, see the <a href="https://forcats.tidyverse.org/">forcats documentation</a></p>
</section>
<section id="challenge-exercise-plot-tips-by-weekday" class="slide level2 center">
<h2>üíª Challenge Exercise: Plot Tips by Weekday</h2>
<p>In this exercise, you learn two things:</p>
<ul>
<li><p>to correctly use <code>stat = identity</code> with bar plots</p></li>
<li><p>to control the order of categories in bar plots, using both <code>factor()</code> and the <code>forcats</code> function called <code>fct_relevel()</code></p></li>
</ul>
</section>
<section id="create-the-data" class="slide level2 center">
<h2>Create the Data</h2>
<p>Copy and run the code below to create this dataset:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb29-2"><a></a></span>
<span id="cb29-3"><a></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb29-4"><a></a>  <span class="at">week =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Wed"</span>, <span class="st">"Fri"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Sat"</span>, <span class="st">"Sat"</span>),</span>
<span id="cb29-5"><a></a>  <span class="at">tip =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">20</span>, <span class="dv">8</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb29-6"><a></a>)</span>
<span id="cb29-7"><a></a></span>
<span id="cb29-8"><a></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Our Goal:</strong> Create a bar plot with days of the <code>week</code> on the x-axis and the total <code>tip</code> amount on the y-axis (e.g., Saturday should display a bar with a height of $55, etc.).</p>
</section>
<section id="whats-wrong-with-this-plot" class="slide level2 center">
<h2>What‚Äôs Wrong With This Plot?</h2>
<p>Try this code. What does the height of each bar represent?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> week)) <span class="sc">+</span></span>
<span id="cb30-2"><a></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><fragment></fragment></p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>Why aren‚Äôt the bars showing the actual tip amounts?<br>
- Because by default, <code>geom_bar()</code> uses <code>stat = "count"</code> to counts row and plot them on the y-axis<br>
- To plot the actual values (not counts), use <code>stat = "identity"</code> with both a x and y</p>
</div>
</div>
</div>
<p></p>
</section>
<section id="fix-the-y-axis-on-this-bar-plot" class="slide level2 center">
<h2>Fix the y-axis on this bar plot</h2>
<p>To fix this plot, we need to change the default <code>stat</code> from count to identity and manually specify both the <code>x</code> and <code>y</code> aesthetics. <em>See the <a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">documentation</a> or type <code>?geom_bar</code> in your R Console.</em></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> tip)) <span class="sc">+</span></span>
<span id="cb31-2"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb31-3"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tips by Weekday"</span>, <span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Tip ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is much better, but we still do not have the bars nicely ordered‚Ä¶.</p>
</section>
<section id="fix-the-order-of-the-bars-using-factor" class="slide level2 center">
<h2>Fix the order of the bars using factor()</h2>
<p>We use base R‚Äôs <code>factor()</code> to control the order of weekdays.</p>
<p>Replace the blank with the correct weekday order in the code below:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>df <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">factor</span>(week, <span class="at">levels =</span> _____ )) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> tip)) <span class="sc">+</span></span>
<span id="cb32-4"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tips by Weekday"</span>, <span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Tip ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="do-the-same-but-using-fct_relevel" class="slide level2 center">
<h2>Do the same but using fct_relevel()</h2>
<p>Now we make the same plot using <a href="https://forcats.tidyverse.org/reference/fct_relevel.html"><code>fct_relevel()</code></a></p>
<p>Replace the correct weekday order in the code below:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>df <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">fct_relevel</span>(week, ______ )) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> tip)) <span class="sc">+</span></span>
<span id="cb33-4"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb33-5"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tips by Weekday"</span>, <span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Tip ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--

Note: Leave out for CSP, bring back for CSS class. The actual code gives what I want (Sat is 55 etc) so unsure this is actually needed

## Group and Summarize

Now try grouping by weekday and summing the tips before plotting. Use either `factor()` or `fct_relevel()`.

```r
df %>%
  mutate(week = factor(week, days)) %>%   # factor() or fct_relevel()
  group_by(week) %>%
  summarize(total_tip = sum(tip)) %>%
  ggplot(aes(x = week, y = total_tip)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Tips by Weekday", x = "Weekday", y = "Total Tip ($)")
```

Add this on slides: Keep these tricks in mind for the homework assignments, especially HW3 (e.g., how to change a variable into a factor and manually pass labels for your graphs; and how to reorder a variable chronologically (here Mon to Sat) for plotting purposes)

Consider putting this challenge in the practice exercises for today as well

For the dplyr part: add in the Rmd file demo an example of what happens if you calculate the mean of a boolean or logical vectors (T and F), say that T are interpreted as 1 and F are 0 for R; this is useful again for HW3!  
-->
</section>
<section id="solutions" class="slide level2 center">
<h2>Solutions</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a><span class="co"># With factor</span></span>
<span id="cb34-2"><a></a>days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>)</span>
<span id="cb34-3"><a></a>df <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">factor</span>(week, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> tip)) <span class="sc">+</span></span>
<span id="cb34-6"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb34-7"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tips by Weekday"</span>, <span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Tip ($)"</span>)</span>
<span id="cb34-8"><a></a></span>
<span id="cb34-9"><a></a><span class="co"># With fct_relevel</span></span>
<span id="cb34-10"><a></a>days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Mon"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>)</span>
<span id="cb34-11"><a></a>df <span class="sc">|&gt;</span></span>
<span id="cb34-12"><a></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">fct_relevel</span>(week, days)) <span class="sc">|&gt;</span></span>
<span id="cb34-13"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> tip)) <span class="sc">+</span></span>
<span id="cb34-14"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tips by Weekday"</span>, <span class="at">x =</span> <span class="st">"Weekday"</span>, <span class="at">y =</span> <span class="st">"Tip ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-none no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p><strong>Q: Why don‚Äôt we use <code>labels</code> in <code>factor()</code>?</strong> Because the values (<code>"Mon"</code>, etc.) are already readable. You don‚Äôt need to change them, unless you want different names (e.g., <code>"Monday"</code>, etc.).</p>
<p><strong>Q: Why doesn‚Äôt <code>days</code> include all 7 days of the week?</strong> We should include all possible levels when using <code>factor()</code>. But <code>fct_relevel()</code> behave differently and may not add missing levels if those values aren‚Äôt present in the input data.</p>
</div>
</div>
</div>
<!--
Note the c() is the standard way of creating a vector 
but fct_relevel() accepts multiple strings directly via ..., so you can skip c() and write directly fct_relevel(week, "Mon", "Wed", "Thu", "Fri", "Sat"_
Both versions are valid

FOR CSS CLASS: add one example with fct_reorder() as it is the most straightforward application
-->
</section>
<section id="reflections" class="slide level2 center">
<h2>Reflections</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<ul>
<li>What happens when you don‚Äôt set the factor order?</li>
<li>Which method (<code>factor()</code> or <code>fct_relevel()</code>) do you prefer and why? Check the <code>forcats</code> package documentation for more functions, especially <code>fct_reorder()</code> which is straightforward to use</li>
<li>Why is <code>stat = "identity"</code> necessary for this kind of plot?</li>
<li>Always match the number of provided <code>levels</code> and <code>labels</code> inside `factor()``</li>
</ul>
</div>
</div>
</div>
<p>Want more practice? Download today‚Äôs in-class materials for more practice exercises on working with factors!</p>
</section>
<section id="recap-what-we-learned-today" class="slide level2 center">
<h2>Recap: What We Learned Today</h2>
<ul>
<li>What factors are and how to convert character or numeric vectors to factors<br>
</li>
<li>How to control the order of categories using <code>levels</code> and <code>labels</code><br>
</li>
<li>How to fix common <code>geom_bar()</code> plotting issues (e.g., bar heights and order)</li>
<li>Reviewed and expanded <code>dplyr</code> functions for data manipulation</li>
</ul>
</section>
<section id="to-print-these-slides-as-pdf" class="slide level2 center">
<h2>To print these slides as pdf</h2>
<p>Click on the icon bottom-right corner &gt; Tools &gt; PDF Export Mode &gt; Print as a Pdf</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>